{"version":3,"file":"/Modules/Category/Assets/admin/js/category.js","mappings":"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","sources":["webpack:///./Modules/Category/Resources/assets/admin/js/CategoryTree.js","webpack:///./Modules/Category/Resources/assets/admin/js/app.js","webpack:///./Modules/Category/Resources/assets/admin/js/CategoryForm.js"],"sourcesContent":["export default class {\n    constructor(categoryForm, selector) {\n        this.selector = selector;\n\n        $.jstree.defaults.dnd.touch = true;\n        $.jstree.defaults.dnd.copy = false;\n\n        this.fetchCategoryTree();\n\n        // On selecting a category.\n        selector.on('select_node.jstree', (e, node) => categoryForm.fetchCategory(node.selected[0]));\n\n        // Expand categories when jstree is loaded.\n        selector.on('loaded.jstree', () => selector.jstree('open_all'));\n\n        // On updating category tree.\n        $(document).on('dnd_stop.vakata', (e, node) => {\n            setTimeout(() => {\n                this.updateCategoryTree(node);\n            }, 100);\n        });\n    }\n\n    fetchCategoryTree() {\n        this.selector.jstree({\n            core: {\n                data: { url: route('admin.categories.tree') },\n                check_callback: true,\n            },\n            plugins: ['dnd'],\n        });\n    }\n\n    updateCategoryTree(node) {\n        this.loading(node, true);\n\n        $.ajax({\n            type: 'PUT',\n            url: route('admin.categories.tree.update'),\n            data: { category_tree: this.getCategoryTree() },\n            success: (message) => {\n                success(message);\n\n                this.loading(node, false);\n            },\n            error: (xhr) => {\n                error(`${xhr.statusText}: ${xhr.responseJSON.message}`);\n\n                this.loading(node, false);\n            },\n        });\n    }\n\n    getCategoryTree() {\n        let categories = this.selector.jstree(true).get_json('#', { flat: true });\n\n        return categories.reduce((formatted, category) => {\n            return formatted.concat({\n                id: category.id,\n                parent_id: (category.parent === '#') ? null : category.parent,\n                position: category.data.position,\n            });\n        }, []);\n    }\n\n    loading(node, state) {\n        for (let nodeElement of node.data.obj) {\n            if (state) {\n                $(nodeElement).addClass('jstree-loading');\n            } else {\n                $(nodeElement).removeClass('jstree-loading');\n            }\n        }\n    }\n}\n","import CategoryForm from './CategoryForm';\n\nnew CategoryForm();\n","import CategoryTree from './CategoryTree';\n\nexport default class {\n    constructor() {\n        let tree = $('.category-tree');\n\n        new CategoryTree(this, tree);\n\n        this.collapseAll(tree);\n        this.expandAll(tree);\n        this.addRootCategory();\n        this.addSubCategory();\n        this.deleteCategory();\n\n        $('#category-form').on('submit', this.submit);\n    }\n\n    collapseAll(tree) {\n        $('.collapse-all').on('click', (e) => {\n            e.preventDefault();\n\n            tree.jstree('close_all');\n        });\n    }\n\n    expandAll(tree) {\n        $('.expand-all').on('click', (e) => {\n            e.preventDefault();\n\n            tree.jstree('open_all');\n        });\n    }\n\n    addRootCategory() {\n        $('.add-root-category').on('click', () => {\n            $('.add-sub-category').addClass('disabled');\n\n            $('.category-tree').jstree('deselect_all');\n\n            this.clear();\n\n            \n        });\n    }\n\n    addSubCategory() {\n        $('.add-sub-category').on('click', () => {\n            let selectedId = $('.category-tree').jstree('get_selected')[0];\n\n            if (selectedId === undefined) {\n                return;\n            }\n\n            this.clear();\n            \n            window.form.appendHiddenInput('#category-form', 'parent_id', selectedId);\n\n            \n        });\n    }\n\n    deleteCategory() {\n        $('.btn-delete-category').on('click', (e) => {\n           \n            swal({\n                title: CI.langs['admin::admin.delete.confirmation'],\n                text: CI.langs['admin::admin.delete.confirmation_message'],\n                type: 'warning',\n                buttons:{\n                    cancel: {\n                        visible: true,\n                        text : CI.langs['admin::admin.delete.btn_cancel'],\n                        className: 'btn btn-danger'\n                    },        \t\t\t\n                    confirm: {\n                        text : CI.langs['admin::admin.delete.btn_delete'],\n                        className : 'btn btn-success'\n                    }\n                }\n            }).then((willDelete) => {\n                if (willDelete) {\n                    $('#categories-delete-form').submit();\n                }\n                $('.btn-delete-category').removeClass('btn-loading');\n                \n            });\n\n        });\n    }\n    fetchCategory(id) {\n        $('.add-sub-category').removeClass('disabled');\n\n        $.ajax({\n            type: 'GET',\n            url: route('admin.categories.show', id),\n            success: (category) => {\n                this.update(category);\n            },\n            error: (xhr) => {\n                error(`${xhr.statusText}: ${xhr.responseJSON.message}`);\n            },\n        });\n    }\n\n    update(category) {\n        window.form.removeErrors();\n\n        $('.btn-delete-category').removeClass('d-none');\n        \n        $('.form-group .help-block').remove();\n\n        $('#categories-delete-form').attr('action', route('admin.categories.destroy', category.id));\n        \n        $('#name').val(category.name);\n\n        $('#slug').val(category.slug);\n        $('#slug-field').removeClass('d-none');\n        \n\n        $('#is_searchable').prop('checked', category.is_searchable);\n        $('#is_active').prop('checked', category.is_active);\n\n        $('#category-form input[name=\"parent_id\"]').remove();\n    }\n\n    clear() {\n        $('#name').val('');\n\n        $('#slug').val('');\n        $('#slug-field').addClass('d-none');\n        \n        $('#is_searchable').prop('checked', false);\n        $('#is_active').prop('checked', false);\n\n        $('.btn-delete-category').addClass('d-none');\n        $('.form-group .help-block').remove();\n\n        $('#category-form input[name=\"parent_id\"]').remove();\n\n    }\n\n    submit(e) {\n        let selectedId = $('.category-tree').jstree('get_selected')[0];\n\n        if (! $('#slug-field').hasClass('d-none')) {\n            window.form.appendHiddenInput('#category-form', '_method', 'put');\n\n            $('#category-form').attr('action', route('admin.categories.update', selectedId));\n        }\n\n        e.currentTarget.submit();\n    }\n}\n"],"names":["categoryForm","selector","this","$","jstree","defaults","dnd","touch","copy","fetchCategoryTree","on","e","node","fetchCategory","selected","document","setTimeout","updateCategoryTree","core","data","url","route","check_callback","plugins","loading","ajax","type","category_tree","getCategoryTree","success","message","error","xhr","statusText","responseJSON","get_json","flat","reduce","formatted","category","concat","id","parent_id","parent","position","state","obj","nodeElement","addClass","removeClass","tree","CategoryTree","collapseAll","expandAll","addRootCategory","addSubCategory","deleteCategory","submit","preventDefault","clear","selectedId","undefined","window","form","appendHiddenInput","swal","title","CI","langs","text","buttons","cancel","visible","className","confirm","then","willDelete","update","removeErrors","remove","attr","val","name","slug","prop","is_searchable","is_active","hasClass","currentTarget"],"sourceRoot":""}